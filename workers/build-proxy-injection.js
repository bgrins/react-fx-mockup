#!/usr/bin/env node

import fs from "fs";
import path from "path";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Read the proxy tunnel script
const sourceFile = path.join(__dirname, "../public/proxy-tunnel.js");
const targetFile = path.join(__dirname, "./proxy-injection.js");

// Read the source file
const scriptContent = fs.readFileSync(sourceFile, "utf8");

// Escape the content for use in a JavaScript string
const escapedContent = scriptContent
  .replace(/\\/g, "\\\\")
  .replace(/`/g, "\\`")
  .replace(/\$/g, "\\$");

// Generate the module content
const moduleContent = `// This file is auto-generated by scripts/build-proxy-injection.js
// Do not edit this file directly. Edit public/proxy-tunnel.js instead.

export const INJECTION_JS = \`${escapedContent}\`;
`;

// Write the module file
fs.writeFileSync(targetFile, moduleContent, "utf8");

console.log(`âœ“ Generated ${targetFile} from ${sourceFile}`);
